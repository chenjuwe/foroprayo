<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>應用程式測試頁面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #FFE5D9 0%, #E5F4FF 100%);
            min-height: 100vh;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #results {
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>🔧 ForoPrayo 應用程式診斷</h1>
    
    <div class="test-section">
        <h2>1. 基礎功能測試</h2>
        <button onclick="testBasicJS()">測試 JavaScript</button>
        <button onclick="testFetch()">測試網路請求</button>
        <button onclick="testLocalStorage()">測試 LocalStorage</button>
        <button onclick="testConsole()">測試 Console</button>
    </div>

    <div class="test-section">
        <h2>2. Firebase 連線測試</h2>
        <button onclick="testFirebaseConfig()">測試 Firebase 配置</button>
        <button onclick="testFirebaseAuth()">測試 Firebase Auth</button>
        <button onclick="testFirestore()">測試 Firestore</button>
    </div>

    <div class="test-section">
        <h2>3. React 應用程式測試</h2>
        <button onclick="testReactApp()">測試主應用程式</button>
        <button onclick="navigateToApp()">跳轉到主應用程式</button>
        <button onclick="checkRootElement()">檢查 Root 元素</button>
    </div>

    <div class="test-section">
        <h2>4. 診斷結果</h2>
        <div id="results"></div>
        <button onclick="clearResults()">清除結果</button>
        <button onclick="downloadResults()">下載診斷報告</button>
    </div>

    <script type="module">
        let results = [];

        function addResult(test, status, message, details = null) {
            const timestamp = new Date().toLocaleString();
            const result = { timestamp, test, status, message, details };
            results.push(result);
            
            const resultsDiv = document.getElementById('results');
            const statusClass = status === 'success' ? 'success' : status === 'error' ? 'error' : 'info';
            
            const resultHtml = `
                <div class="status ${statusClass}">
                    <strong>[${timestamp}] ${test}</strong><br/>
                    ${message}
                    ${details ? `<br/><small>詳細：${details}</small>` : ''}
                </div>
            `;
            resultsDiv.innerHTML += resultHtml;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        window.testBasicJS = function() {
            try {
                const testArray = [1, 2, 3];
                const testObject = { name: 'test', value: 123 };
                const result = testArray.map(x => x * 2);
                
                addResult('JavaScript 基礎功能', 'success', 
                    `JavaScript 運行正常`, 
                    `陣列處理: ${result.join(',')}, 物件: ${JSON.stringify(testObject)}`);
            } catch (error) {
                addResult('JavaScript 基礎功能', 'error', 
                    `JavaScript 執行失敗`, error.message);
            }
        };

        window.testFetch = async function() {
            try {
                const response = await fetch('/');
                const status = response.status;
                addResult('網路請求', 'success', 
                    `網路請求正常 (HTTP ${status})`, 
                    `Content-Type: ${response.headers.get('content-type')}`);
            } catch (error) {
                addResult('網路請求', 'error', 
                    `網路請求失敗`, error.message);
            }
        };

        window.testLocalStorage = function() {
            try {
                const testKey = 'foroprayo-test';
                const testValue = 'test-data-' + Date.now();
                
                localStorage.setItem(testKey, testValue);
                const retrieved = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);
                
                if (retrieved === testValue) {
                    addResult('LocalStorage', 'success', 'LocalStorage 功能正常');
                } else {
                    addResult('LocalStorage', 'error', 'LocalStorage 數據不一致');
                }
            } catch (error) {
                addResult('LocalStorage', 'error', 'LocalStorage 存取失敗', error.message);
            }
        };

        window.testConsole = function() {
            try {
                console.log('ForoPrayo 診斷測試');
                console.warn('這是一個測試警告');
                console.error('這是一個測試錯誤');
                addResult('Console', 'success', 'Console 功能正常（請檢查開發者工具）');
            } catch (error) {
                addResult('Console', 'error', 'Console 功能異常', error.message);
            }
        };

        window.testFirebaseConfig = async function() {
            try {
                // 嘗試載入 Firebase 配置
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                
                const firebaseConfig = {
                    apiKey: "AIzaSyBcFamR8al69jVzgia0kxKIcf5inLpxt0I",
                    authDomain: "foroprayo.firebaseapp.com",
                    projectId: "foroprayo",
                    storageBucket: "foroprayo.firebasestorage.app",
                    messagingSenderId: "863364228350",
                    appId: "1:283821115552:web:9aa4648b3582c8670a71af"
                };
                
                const app = initializeApp(firebaseConfig);
                addResult('Firebase 配置', 'success', 'Firebase 初始化成功', 
                    `Project ID: ${firebaseConfig.projectId}`);
            } catch (error) {
                addResult('Firebase 配置', 'error', 'Firebase 初始化失敗', error.message);
            }
        };

        window.testFirebaseAuth = async function() {
            try {
                const response = await fetch('https://identitytoolkit.googleapis.com/v1/projects/foroprayo');
                if (response.ok || response.status === 400) {
                    addResult('Firebase Auth', 'success', 'Firebase Auth 服務可達');
                } else {
                    addResult('Firebase Auth', 'error', `Firebase Auth 服務異常 (${response.status})`);
                }
            } catch (error) {
                addResult('Firebase Auth', 'error', 'Firebase Auth 連線失敗', error.message);
            }
        };

        window.testFirestore = async function() {
            try {
                const response = await fetch('https://firestore.googleapis.com/v1/projects/foroprayo/databases/(default)/documents');
                if (response.ok || response.status === 401 || response.status === 403) {
                    addResult('Firestore', 'success', 'Firestore 服務可達');
                } else {
                    addResult('Firestore', 'error', `Firestore 服務異常 (${response.status})`);
                }
            } catch (error) {
                addResult('Firestore', 'error', 'Firestore 連線失敗', error.message);
            }
        };

        window.testReactApp = async function() {
            try {
                const response = await fetch('/src/main.tsx');
                if (response.ok) {
                    addResult('React 應用程式', 'success', 'React 主檔案可載入');
                    
                    // 測試 React DOM
                    const rootElement = document.getElementById('react-test-root');
                    if (!rootElement) {
                        const testRoot = document.createElement('div');
                        testRoot.id = 'react-test-root';
                        document.body.appendChild(testRoot);
                    }
                } else {
                    addResult('React 應用程式', 'error', 'React 主檔案無法載入');
                }
            } catch (error) {
                addResult('React 應用程式', 'error', 'React 應用程式測試失敗', error.message);
            }
        };

        window.navigateToApp = function() {
            addResult('導航', 'info', '正在跳轉到主應用程式...');
            setTimeout(() => {
                window.location.href = '/';
            }, 1000);
        };

        window.checkRootElement = function() {
            const rootElement = document.getElementById('root');
            if (rootElement) {
                addResult('Root 元素', 'success', 
                    `Root 元素存在`, 
                    `位置: ${rootElement.tagName}, 內容長度: ${rootElement.innerHTML.length}`);
            } else {
                addResult('Root 元素', 'error', 'Root 元素不存在');
            }
        };

        window.clearResults = function() {
            results = [];
            document.getElementById('results').innerHTML = '';
        };

        window.downloadResults = function() {
            const reportData = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                url: window.location.href,
                results: results
            };
            
            const blob = new Blob([JSON.stringify(reportData, null, 2)], 
                { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `foroprayo-diagnostic-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addResult('診斷報告', 'success', '診斷報告已下載');
        };

        // 自動執行基礎測試
        window.addEventListener('load', () => {
            addResult('頁面載入', 'success', '診斷頁面載入完成');
            setTimeout(() => {
                testBasicJS();
                testLocalStorage();
                checkRootElement();
            }, 500);
        });
    </script>
</body>
</html> 