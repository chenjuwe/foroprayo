<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‡‰ç”¨ç¨‹å¼æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #FFE5D9 0%, #E5F4FF 100%);
            min-height: 100vh;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #results {
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ForoPrayo æ‡‰ç”¨ç¨‹å¼è¨ºæ–·</h1>
    
    <div class="test-section">
        <h2>1. åŸºç¤åŠŸèƒ½æ¸¬è©¦</h2>
        <button onclick="testBasicJS()">æ¸¬è©¦ JavaScript</button>
        <button onclick="testFetch()">æ¸¬è©¦ç¶²è·¯è«‹æ±‚</button>
        <button onclick="testLocalStorage()">æ¸¬è©¦ LocalStorage</button>
        <button onclick="testConsole()">æ¸¬è©¦ Console</button>
    </div>

    <div class="test-section">
        <h2>2. Firebase é€£ç·šæ¸¬è©¦</h2>
        <button onclick="testFirebaseConfig()">æ¸¬è©¦ Firebase é…ç½®</button>
        <button onclick="testFirebaseAuth()">æ¸¬è©¦ Firebase Auth</button>
        <button onclick="testFirestore()">æ¸¬è©¦ Firestore</button>
    </div>

    <div class="test-section">
        <h2>3. React æ‡‰ç”¨ç¨‹å¼æ¸¬è©¦</h2>
        <button onclick="testReactApp()">æ¸¬è©¦ä¸»æ‡‰ç”¨ç¨‹å¼</button>
        <button onclick="navigateToApp()">è·³è½‰åˆ°ä¸»æ‡‰ç”¨ç¨‹å¼</button>
        <button onclick="checkRootElement()">æª¢æŸ¥ Root å…ƒç´ </button>
    </div>

    <div class="test-section">
        <h2>4. è¨ºæ–·çµæœ</h2>
        <div id="results"></div>
        <button onclick="clearResults()">æ¸…é™¤çµæœ</button>
        <button onclick="downloadResults()">ä¸‹è¼‰è¨ºæ–·å ±å‘Š</button>
    </div>

    <script type="module">
        let results = [];

        function addResult(test, status, message, details = null) {
            const timestamp = new Date().toLocaleString();
            const result = { timestamp, test, status, message, details };
            results.push(result);
            
            const resultsDiv = document.getElementById('results');
            const statusClass = status === 'success' ? 'success' : status === 'error' ? 'error' : 'info';
            
            const resultHtml = `
                <div class="status ${statusClass}">
                    <strong>[${timestamp}] ${test}</strong><br/>
                    ${message}
                    ${details ? `<br/><small>è©³ç´°ï¼š${details}</small>` : ''}
                </div>
            `;
            resultsDiv.innerHTML += resultHtml;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        window.testBasicJS = function() {
            try {
                const testArray = [1, 2, 3];
                const testObject = { name: 'test', value: 123 };
                const result = testArray.map(x => x * 2);
                
                addResult('JavaScript åŸºç¤åŠŸèƒ½', 'success', 
                    `JavaScript é‹è¡Œæ­£å¸¸`, 
                    `é™£åˆ—è™•ç†: ${result.join(',')}, ç‰©ä»¶: ${JSON.stringify(testObject)}`);
            } catch (error) {
                addResult('JavaScript åŸºç¤åŠŸèƒ½', 'error', 
                    `JavaScript åŸ·è¡Œå¤±æ•—`, error.message);
            }
        };

        window.testFetch = async function() {
            try {
                const response = await fetch('/');
                const status = response.status;
                addResult('ç¶²è·¯è«‹æ±‚', 'success', 
                    `ç¶²è·¯è«‹æ±‚æ­£å¸¸ (HTTP ${status})`, 
                    `Content-Type: ${response.headers.get('content-type')}`);
            } catch (error) {
                addResult('ç¶²è·¯è«‹æ±‚', 'error', 
                    `ç¶²è·¯è«‹æ±‚å¤±æ•—`, error.message);
            }
        };

        window.testLocalStorage = function() {
            try {
                const testKey = 'foroprayo-test';
                const testValue = 'test-data-' + Date.now();
                
                localStorage.setItem(testKey, testValue);
                const retrieved = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);
                
                if (retrieved === testValue) {
                    addResult('LocalStorage', 'success', 'LocalStorage åŠŸèƒ½æ­£å¸¸');
                } else {
                    addResult('LocalStorage', 'error', 'LocalStorage æ•¸æ“šä¸ä¸€è‡´');
                }
            } catch (error) {
                addResult('LocalStorage', 'error', 'LocalStorage å­˜å–å¤±æ•—', error.message);
            }
        };

        window.testConsole = function() {
            try {
                console.log('ForoPrayo è¨ºæ–·æ¸¬è©¦');
                console.warn('é€™æ˜¯ä¸€å€‹æ¸¬è©¦è­¦å‘Š');
                console.error('é€™æ˜¯ä¸€å€‹æ¸¬è©¦éŒ¯èª¤');
                addResult('Console', 'success', 'Console åŠŸèƒ½æ­£å¸¸ï¼ˆè«‹æª¢æŸ¥é–‹ç™¼è€…å·¥å…·ï¼‰');
            } catch (error) {
                addResult('Console', 'error', 'Console åŠŸèƒ½ç•°å¸¸', error.message);
            }
        };

        window.testFirebaseConfig = async function() {
            try {
                // å˜—è©¦è¼‰å…¥ Firebase é…ç½®
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                
                const firebaseConfig = {
                    apiKey: "AIzaSyBcFamR8al69jVzgia0kxKIcf5inLpxt0I",
                    authDomain: "foroprayo.firebaseapp.com",
                    projectId: "foroprayo",
                    storageBucket: "foroprayo.firebasestorage.app",
                    messagingSenderId: "863364228350",
                    appId: "1:283821115552:web:9aa4648b3582c8670a71af"
                };
                
                const app = initializeApp(firebaseConfig);
                addResult('Firebase é…ç½®', 'success', 'Firebase åˆå§‹åŒ–æˆåŠŸ', 
                    `Project ID: ${firebaseConfig.projectId}`);
            } catch (error) {
                addResult('Firebase é…ç½®', 'error', 'Firebase åˆå§‹åŒ–å¤±æ•—', error.message);
            }
        };

        window.testFirebaseAuth = async function() {
            try {
                const response = await fetch('https://identitytoolkit.googleapis.com/v1/projects/foroprayo');
                if (response.ok || response.status === 400) {
                    addResult('Firebase Auth', 'success', 'Firebase Auth æœå‹™å¯é”');
                } else {
                    addResult('Firebase Auth', 'error', `Firebase Auth æœå‹™ç•°å¸¸ (${response.status})`);
                }
            } catch (error) {
                addResult('Firebase Auth', 'error', 'Firebase Auth é€£ç·šå¤±æ•—', error.message);
            }
        };

        window.testFirestore = async function() {
            try {
                const response = await fetch('https://firestore.googleapis.com/v1/projects/foroprayo/databases/(default)/documents');
                if (response.ok || response.status === 401 || response.status === 403) {
                    addResult('Firestore', 'success', 'Firestore æœå‹™å¯é”');
                } else {
                    addResult('Firestore', 'error', `Firestore æœå‹™ç•°å¸¸ (${response.status})`);
                }
            } catch (error) {
                addResult('Firestore', 'error', 'Firestore é€£ç·šå¤±æ•—', error.message);
            }
        };

        window.testReactApp = async function() {
            try {
                const response = await fetch('/src/main.tsx');
                if (response.ok) {
                    addResult('React æ‡‰ç”¨ç¨‹å¼', 'success', 'React ä¸»æª”æ¡ˆå¯è¼‰å…¥');
                    
                    // æ¸¬è©¦ React DOM
                    const rootElement = document.getElementById('react-test-root');
                    if (!rootElement) {
                        const testRoot = document.createElement('div');
                        testRoot.id = 'react-test-root';
                        document.body.appendChild(testRoot);
                    }
                } else {
                    addResult('React æ‡‰ç”¨ç¨‹å¼', 'error', 'React ä¸»æª”æ¡ˆç„¡æ³•è¼‰å…¥');
                }
            } catch (error) {
                addResult('React æ‡‰ç”¨ç¨‹å¼', 'error', 'React æ‡‰ç”¨ç¨‹å¼æ¸¬è©¦å¤±æ•—', error.message);
            }
        };

        window.navigateToApp = function() {
            addResult('å°èˆª', 'info', 'æ­£åœ¨è·³è½‰åˆ°ä¸»æ‡‰ç”¨ç¨‹å¼...');
            setTimeout(() => {
                window.location.href = '/';
            }, 1000);
        };

        window.checkRootElement = function() {
            const rootElement = document.getElementById('root');
            if (rootElement) {
                addResult('Root å…ƒç´ ', 'success', 
                    `Root å…ƒç´ å­˜åœ¨`, 
                    `ä½ç½®: ${rootElement.tagName}, å…§å®¹é•·åº¦: ${rootElement.innerHTML.length}`);
            } else {
                addResult('Root å…ƒç´ ', 'error', 'Root å…ƒç´ ä¸å­˜åœ¨');
            }
        };

        window.clearResults = function() {
            results = [];
            document.getElementById('results').innerHTML = '';
        };

        window.downloadResults = function() {
            const reportData = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                url: window.location.href,
                results: results
            };
            
            const blob = new Blob([JSON.stringify(reportData, null, 2)], 
                { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `foroprayo-diagnostic-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addResult('è¨ºæ–·å ±å‘Š', 'success', 'è¨ºæ–·å ±å‘Šå·²ä¸‹è¼‰');
        };

        // è‡ªå‹•åŸ·è¡ŒåŸºç¤æ¸¬è©¦
        window.addEventListener('load', () => {
            addResult('é é¢è¼‰å…¥', 'success', 'è¨ºæ–·é é¢è¼‰å…¥å®Œæˆ');
            setTimeout(() => {
                testBasicJS();
                testLocalStorage();
                checkRootElement();
            }, 500);
        });
    </script>
</body>
</html> 