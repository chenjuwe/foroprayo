rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 用戶資料集合
    match /users/{userId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 用戶頭像集合
    match /avatars/{userId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 用戶背景集合
    match /user_backgrounds/{userId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 代禱集合
    match /prayers/{prayerId} {
      // 公開讀取
      allow read: if true;
      // 放寬權限：允許任何人創建代禱
      allow create: if true;
      // 只有代禱作者可以更新或刪除
      allow update, delete: if request.auth != null && 
                              request.auth.uid == resource.data.user_id;
    }
    
    // 代禱回應集合
    match /prayer_responses/{responseId} {
      // 公開讀取
      allow read: if true;
      // 放寬權限：允許任何人創建回應
      allow create: if true;
      // 只有回應作者可以更新或刪除
      allow update, delete: if request.auth != null && 
                              request.auth.uid == resource.data.user_id;
    }
    
    // 讚集合
    match /prayer_likes/{likeId} {
      // 讀取限制
      allow read: if true;
      // 只有登入用戶可以創建自己的讚
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
      // 只有讚的作者可以刪除
      allow delete: if request.auth != null && resource.data.user_id == request.auth.uid;
      // 不允許更新
      allow update: if false;
    }

    // 回應的讚集合
    match /prayer_response_likes/{likeId} {
      allow read: if true;
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
      allow delete: if request.auth != null && resource.data.user_id == request.auth.uid;
      allow update: if false;
    }

    // ============================================================
    // 新增的集合規則
    // ============================================================

    // 受洗 (Baptism) 集合
    match /baptism/{postId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.user_id;
    }

    match /baptism_responses/{responseId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.user_id;
    }

    // 旅程 (Journey) 集合
    match /journey/{postId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.user_id;
    }

    match /journey_responses/{responseId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.user_id;
    }

    // 神蹟 (Miracle) 集合
    match /miracle/{postId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.user_id;
    }

    match /miracle_responses/{responseId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.user_id;
    }
  }
} 